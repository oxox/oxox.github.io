window.yx_xdata_i18n=window.yx_xdata_i18n||{};yx_xdata_i18n["zh-CN"]={com:{refresh:"\u5237\u65B0",update:"\u66F4\u65B0",edit:"\u7F16\u8F91","delete":"\u5220\u9664",showHeatmap:"\u663E\u793A\u70ED\u533A\u56FE",avg:"\u5E73\u5747",avgValue:"\u5E73\u5747\u503C",total:"\u5171",ci:"\u6B21",dan:"\u5355",n1:"\u4E00",n2:"\u4E8C",n3:"\u4E09",n4:"\u56DB",n5:"\u4E94",n6:"\u516D",n7:"\u4E03",n8:"\u516B",n9:"\u4E5D",n10:"\u5341",n11:"\u5341\u4E00",n12:"\u5341\u4E8C",month:"\u6708",week:"\u661F\u671F",day:"\u5929",day1:"\u65E5",date:"\u65E5\u671F",recent:"\u6700\u8FD1",moreCondition:"\u66F4\u591A\u6761\u4EF6",actFloor:"\u6D3B\u52A8\u697C\u5C42",actHead:"\u6D3B\u52A8\u9996\u5C4F",actSidenavRight:"\u6D3B\u52A8\u53F3\u8FB9\u5BFC\u822A",actSidenavLeft:"\u6D3B\u52A8\u5DE6\u8FB9\u5BFC\u822A"},nav:{a:"\u70B9\u51FB\u91CF",b:"\u4E0B\u5355\u91CF",c:"\u8F6C\u5316\u7387"},chart:{resetZoom:"\u67E5\u770B\u5168\u56FE",downloadPNG:"\u4E0B\u8F7DPNG",downloadJPEG:"\u4E0B\u8F7DJPEG",downloadPDF:"\u4E0B\u8F7DPDF",downloadSVG:"\u4E0B\u8F7DSVG",exportButtonTitle:"\u5BFC\u51FA\u6210\u56FE\u7247",printChart:"\u6253\u5370\u56FE\u8868",loading:"\u6570\u636E\u52A0\u8F7D\u4E2D\uFF0C\u8BF7\u7A0D\u5019..."},chart1:{title:"\u6574\u4F53\u6570\u636E"},chart2:{title:"\u6A21\u5757\u8D8B\u52BF",title1:"\u8BE6\u7EC6\u6570\u636E",btnAddPrivateMod:"\u65B0\u589E\u79C1\u6709\u6A21\u5757",btnAdminMod:"\u6A21\u5757\u7EF4\u62A4",btnSetVersion:"\u8BBE\u7F6E\u7248\u672C\u70B9",btnModHis:"\u7248\u672C\u5386\u53F2",btnModCompare:"\u6DFB\u52A0\u5BF9\u6BD4",btnBeginCompare:"\u5F00\u59CB\u5BF9\u6BD4",clickRate:"\u70B9\u51FB\u7387",orderRate:"\u8BA2\u5355\u7387",transRateByClick:"\u8F6C\u5316\u7387",transRateByPV:"\u6BCFPV\u8F6C\u5316\u7387",clickNumByPV:"\u6BCFPV\u70B9\u51FB\u7387",orderNumByPV:"\u6BCFPV\u4E0B\u5355\u7387",transRateByUV:"\u6BCFUV\u8F6C\u5316\u7387",clickNumByUV:"\u6BCFUV\u70B9\u51FB\u7387",orderNumByUV:"\u6BCFUV\u4E0B\u5355\u7387",summary:"\u5168\u90E8\u6C47\u603B"},tip:{modNameRequired:"\u8BF7\u8F93\u5165\u6A21\u5757\u540D\u79F0",modNameValueRule:"\u8BF7\u8F93\u5165\u6A21\u5757\u7684css\u9009\u62E9\u5668\u6216\u4EE5|\u5206\u9694\u7684ytag",modNameValueRequired:"\u6A21\u5757\u540D\u79F0\u548Cytag\u9009\u62E9\u5668\u5747\u4E0D\u80FD\u4E3A\u7A7A\uFF01",beginDateEndDateRequired:"\u5F00\u59CB\u65F6\u95F4\u548C\u7ED3\u675F\u65F6\u95F4\u4E0D\u80FD\u4E3A\u7A7A\uFF01",dateRangeOvertop:"\u7EDF\u8BA1\u65F6\u95F4\u8303\u56F4\u8D85\u8FC7$\u5929\uFF01\u670D\u52A1\u5668\u4E9A\u5386\u5C71\u5927...",hidden:"\u5F53\u524D\u5904\u4E8E\u9690\u85CF\u72B6\u6001...",uvTip:"\u4ECA\u5929\u7684UV\u8981\u660E\u5929\u624D\u80FD\u770B\u54E6",noDataAdvice:"\u5F53\u524D\u9875\u9762\u53EA\u6709\u5168\u7AD9\u516C\u5171\u6A21\u5757,\u8FD8\u6CA1\u6709\u9875\u9762\u79C1\u6709\u6A21\u5757\u6570\u636E,\u53EF\u8054\u7CFBjoyma\u6216levinhuang\u6DFB\u52A0\u79C1\u6709\u6A21\u5757\u6570\u636E",permissionDeny:"\u60A8\u6CA1\u6709\u767B\u5F55\u6216\u8005\u6CA1\u6709clickstream\u6743\u9650,\u7533\u8BF7\u6743\u9650\u8BF7RTX\u8054\u7CFB\u4F55\u8FEA(Dihe)."},ajax:{paramError:"\u83B7\u53D6\u7EDF\u8BA1\u53C2\u6570\u5931\u8D25\uFF01",noData:"\u65E0\u6570\u636E",presetModError:"\u9884\u8BBE\u6A21\u5757\u8BFB\u53D6\u51FA\u9519!",serverError:"\u670D\u52A1\u5668\u9519\u8BEF\uFF01"}};J("data",function(p){var uid=null,pid=window.yPageId||"1000",wsid=null,areaid=null,today=new Date(),ck=(document.cookie||""),isParamsReady=false;try{uid=ck.split("yx_uid=")[1].split(";")[0];wsid=ck.split("wsid=")[1].split(";")[0];areaid=ck.split("areasInfo=");areaid=areaid.length>1?(areaid[1].split(";")[0]||"S0001_1001"):"S0001_1001";this.bizInfo={uid:uid,wsid:wsid,pid:pid,areaid:areaid};this.boss=["6775494","8657580","765578"];isParamsReady=true}catch(e){J.log(i18n.t("ajax.paramError")+e.toString())}var clickStreamData=function(_type,_params,_cbk){if(!isParamsReady){_cbk(i18n.t("ajax.paramError"));return null}var jqXHR=$.ajax({type:"POST",url:"http://statistic.yixun.com/json.php?mod=stat&act="+_type,data:_params,dataType:"json"}).fail(function(jqXHR,txtStatus,err){_cbk(_type+":"+err)}).done(function(data,txtStatus,jqXHR){_cbk(null,data)});return jqXHR};this.getDateTimeStr=function(dObj,cfg){cfg=cfg||{};cfg.len=cfg.len||19;cfg.dayDiff=cfg.dayDiff||0;if(cfg.dayDiff!==0){dObj.setDate(dObj.getDate()+cfg.dayDiff)}var o=[dObj.getFullYear()+"-",(dObj.getMonth()+1)],format=function(i){return(i<10?("0"+i):i)};o[1]=format(o[1])+"-";o.push(format(dObj.getDate()));if(cfg.ignoreHMS){o.push(" 00:00:00")}else{o.push(" ");tempObj=dObj.getHours();o.push(format(dObj.getHours())+":");o.push(format(dObj.getMinutes())+":");o.push(format(dObj.getSeconds()))}return o.join("").substr(0,cfg.len)};this.getKeyData=function(_params,cbk){_params=$.extend({},{uid:uid,start_date:J.data.getDateTimeStr(today,{ignoreHMS:true}),end_date:J.data.getDateTimeStr(today),date_type:"today",page_id:pid,warehouse_id:wsid,areasInfo:areaid},_params||{});return clickStreamData("PageKeyData",_params,cbk)};this.getClickData=function(_params,cbk){_params=$.extend({},{uid:uid,start_date:J.data.getDateTimeStr(today,{ignoreHMS:true}),end_date:J.data.getDateTimeStr(today),date_type:"today",page_id:pid,warehouse_id:wsid,areasInfo:areaid},_params||{});return clickStreamData("PageClickData",_params,cbk)};this.getClickDataBySelector=function(cssSelector){var ids=[],tempCache={},id,addTag=function(o){id=o.getAttribute("ytag");if(id&&(!tempCache[id])){ids.push(id);tempCache[id]=true}};$(cssSelector).find("[ytag]").each(function(i,o){addTag(o)}).end().each(function(i,o){addTag(o)});return J.data.getClickDataByIds(ids)};this.getClickDataByIds=function(ids){var len=0,obj=null,clickData=J.data.CurrentClickData.data,items=[],found=false;if((len=ids.length)==0){return items}for(var i=0;i<len;i++){found=false;for(var c in clickData){obj=clickData[c];if(obj.page_tag===ids[i]){items.push(obj);found=true;break}}if(!found){items.push({click_num:0,click_trans_rate:0,order_num:0,page_tag:ids[i]})}}return items};this.getClickDataById=function(id){var obj=null,noData=i18n.t("ajax.noData");for(var c in J.data.CurrentClickData.data){obj=J.data.CurrentClickData.data[c];if(obj.page_tag===id){break}}return obj||{click_num:noData,click_trans_rate:noData,order_num:noData}};this.getRangeClickData=function(_params,cbk){_params=$.extend({},{uid:uid,start_date:J.data.getDateTimeStr(today,{ignoreHMS:true}),end_date:J.data.getDateTimeStr(today),date_type:"today",page_id:pid,warehouse_id:wsid,areasInfo:areaid,page_tag_ids:"-1",sumByDate:1},_params||{});return clickStreamData("DragClickData",_params,cbk)};this.getItemDimension=function($o){if($o.length===0){return null}var $parent=$o.parent(),off=$o.offset()||{top:0,left:0},data={left:off.left,top:off.top,width:$o.outerWidth(),height:$o.outerHeight(),parentWidth:$parent.outerWidth(),parentHeight:$parent.outerHeight()};return data};this.getKeyAndClickData=function(_params,cbk){J.data.jqXHRKeyData=J.data.getKeyData(_params,function(err,data){if(data&&data.status){data.total.pv=parseInt((data.total.pv+"").replace(/,/g,""));data.total.uv=parseInt((data.total.uv+"").replace(/,/g,""));data.total.click_num=parseInt((data.total.click_num+"").replace(/,/gi,""));data.total.order_num=parseInt((data.total.order_num+"").replace(/,/gi,""));data.total.click_trans_rate=data.total.click_num==0?0:(data.total.order_num*100/data.total.click_num).toFixed(2);data.total.click_trans_rate=parseFloat(data.total.click_trans_rate)}J.data.CurrentKeyData=data;J.data.jqXHRKeyData=null;J.$win.trigger(J.data.EVT.KeyDataChange,[err,data]);if(err){cbk&&cbk(err);return}J.data.jqXHRClickData=J.data.getClickData(_params,function(err1,data1){J.data.CurrentClickData=data1;J.data.jqXHRClickData=null;J.$win.trigger(J.data.EVT.ClickDataChange,[err1,data1]);if(err1){cbk&&cbk(err1);return}cbk&&cbk(null,data,data1)})})};this.getPublicMods=function(cbk){var _params={act:"query",xn:"xdata",xk:"mods_-J8cz2Qpn7_rKE2jiImK",t:new Date().getTime()};var url="http://log.oxox.io/api.php",xhr;xhr=$.ajax({url:url,dataType:"json",data:_params});xhr.done(function(d,txtStatus,jqXhr){if(d.code!=="1"){cbk(d.info);return}J.data.publicMods=d.info.xv;cbk(null,J.data.publicMods)}).fail(function(jqXhr,txtStatus,err){cbk(err)})};this.getPrivateModsByCssSelector=function(){if(location.hostname!=="event.yixun.com"){return({})}var cssList={floor:".evt_floor,.act_sec",header:".evt_head,.act_head",sideNavRight:".act_sidenav,.evt_nav_right",sideNavLeft:".act_sidenav1,.evt_nav_left"},txtList={floor:i18n.t("com.actFloor"),header:i18n.t("com.actHead"),sideNavRight:i18n.t("com.actSidenavRight"),sideNavLeft:i18n.t("com.actSidenavLeft")},mods={},tempId="",tempClasses0=null,tempClasses1=null,len=null;for(var c in cssList){$(cssList[c]).each(function(i,o){tempClasses0=o.className.split(" ");tempClasses1=[];len=tempClasses0.length;for(var j=0;j<len;j++){if(tempClasses0[j]===""){continue}tempClasses1.push(tempClasses0[j])}tempId=tempClasses1.join("_")+"_"+(i+1);mods[tempId]={id:tempId,alias:txtList[c]+(i+1),ytagSelector:"."+tempClasses1.join("."),isCustomYTag:true,type:1}})}return mods};this.getPageConfigs=function(cbk){var _params={act:"query",xn:"xdata",xk:"pages",t:new Date().getTime()};var url="http://log.oxox.io/api.php",xhr;xhr=$.ajax({url:url,dataType:"json",data:_params});xhr.done(function(d,txtStatus,jqXhr){if(d.code!=="1"){cbk(d.info);return}J.data.pages=d.info.xv;cbk(null,J.data.pages)}).fail(function(jqXhr,txtStatus,err){cbk(err)})};this.getDefaultCTags=function(cbk){var _params={act:"query",xn:"xdata",t:new Date().getTime()};var url="http://log.oxox.io/api.php",xhr;J.data.getPageConfigs(function(err,msg){if(err){cbk("getPageConfigs error:"+err);return}var page=J.data.getPageConfigByUrl(location.href);if(!page){console.log("getPageConfigByUrl no data",location.href)}J.data.getPublicMods(function(err1,msg1){if(err1){cbk("getPublicMods error:"+err1);return}J.data.privateMods=[];if(!page){cbk(null,msg1);return}xhr=$.ajax({url:url,dataType:"json",data:$.extend({},_params,{xk:"mods_"+page.$id})});xhr.done(function(d2,txtStatus2,jqXhr2){if(d2.code!=="1"){cbk(d2.info);return}J.data.privateMods=d2.info.xv;cbk(null,msg1.concat(d2.info.xv))}).fail(function(jqXhr2,txtStatus2,err2){cbk(err2)})})})};this.getPageConfigByUrl=function(url){var len=0,tempPage,page;if(!this.pages||(len=this.pages.length)==0){return null}for(var i=0;i<len;i++){tempPage=this.pages[i];if(url.toLowerCase().indexOf(tempPage.url)>-1){page=tempPage}}return page};this.getDefaultCTagById=function(id){var pageCTags=(J.data.defaultCTags||[]),len=pageCTags.length,obj=null;for(var i=0;i<len;i++){if(pageCTags[i].id.toString()===id){obj=pageCTags[i];break}}return obj};this.getAllCTags=function(cbk){var items=J.data.getCTags()||[];if(!J.data.defaultCTags){J.data.getDefaultCTags(function(err,d){if(err){console.log(i18n.t("ajax.presetModError"),err);cbk(items);return}J.data.defaultCTags=d||[];items=items.concat(J.data.defaultCTags);cbk(items)});return}items=items.concat(J.data.defaultCTags);cbk(items)};this.getCTags=function(rawForm){rawForm=rawForm||false;var key="xdata_ctags_"+J.data.bizInfo.pid,rawData=localStorage[key],rawData1=J.data.getPrivateModsByCssSelector(),isRawData1Empty=Object.getOwnPropertyNames(rawData1).length==0;if(!rawData){if(isRawData1Empty){return null}rawData="{}"}rawData=JSON.parse(rawData);$.extend(rawData,rawData1);if(rawForm){return rawData}var tags=[];for(var c in rawData){tags.push(rawData[c])}return tags};this.getCTag=function(id){var d=J.data.getCTags(true)||{};d=d[id]||J.data.getDefaultCTagById(id);return d};this.saveCTag=function(tagData){var d=J.data.getCTags(true)||{},isNew=false;if(tagData.id==""){tagData.id=new Date().getTime()}if(!J.data.getCTag(tagData.id)){isNew=true}d[tagData.id]=tagData;var key="xdata_ctags_"+J.data.bizInfo.pid;localStorage[key]=JSON.stringify(d);J.$win.trigger(J.data.EVT.CTagUpdated,[(isNew?0:1),tagData]);return d};this.deleteCTag=function(id){var d=J.data.getCTags(true);if(!d){return null}if(!d[id]){return d}delete d[id];var key="xdata_ctags_"+J.data.bizInfo.pid;localStorage[key]=JSON.stringify(d);J.$win.trigger(J.data.EVT.CTagUpdated,[-1,id]);return d};this.abortKeyAndClickDataRequest=function(){var jqXHR=J.data.jqXHRKeyData;if(jqXHR&&jqXHR.readyState!=4){jqXHR.abort()}jqXHR=J.data.jqXHRClickData;if(jqXHR&&jqXHR.readyState!=4){jqXHR.abort()}};this.getSafeCurrentKeyData=function(dataType){var item={id:"-1",click_num:0,order_num:0,click_trans_rate:0,val:0};var total=(J.data.CurrentKeyData&&J.data.CurrentKeyData.status)?J.data.CurrentKeyData.total:item;$.extend(item,total);switch(dataType){case 1:item.val=item.click_num;break;case 2:item.val=item.order_num;break;case 3:item.val=item.click_trans_rate;break}return item};this.isBoss=function(uid){var bossList=J.data.boss||[];return($.inArray(uid,bossList)!==-1)};this.ytag=(function(){var p1={getData:function(dataType,topCnt){var rawData=J.data.CurrentClickData,niceData=this.parseData(rawData,dataType,topCnt);return niceData},parseData:function(d,dataType,topCnt){d=d.data;var items=[];for(var c in d){if(typeof(d[c])!=="object"){continue}items.push(d[c])}items=this.orderDataDescBy(items,dataType);topCnt=topCnt||50;var len=items.length,r={empty:false,items:[]};len=len>=topCnt?topCnt:len;if(len==0){r.empty=true;return r}for(var i=0;i<len;i++){switch(dataType){case 1:items[i].val=items[i].click_num;break;case 2:items[i].val=items[i].order_num;break;case 3:items[i].val=items[i].click_trans_rate;break}r.items.push(items[i])}return r},orderDataDescBy:function(arrData,dataType){arrData=arrData.slice(0);switch(dataType){case 1:break;case 2:arrData.sort(function(a,b){return(b.order_num-a.order_num)});break;case 3:arrData.sort(function(a,b){return(parseFloat(b.click_trans_rate)-parseFloat(a.click_trans_rate))});break}return arrData}};var pub1={getTopList:function(dataType,topCnt){return p1.getData(dataType,topCnt)}};return pub1})();this.EVT={KeyDataChange:"onXDataKeyDataChanged",ClickDataChange:"onXDataClickDataChanged",CTagUpdated:"onXDataCTagUpdated"};this.pages=[];this.publicMods=[];this.privateMods=[];this.init=function(){this.getKeyAndClickData(null)}});J("ui",function(M,V,C){V.tpl0=J.heredoc(function(){});C._init=function(){J.ui.EVT(["onClickXbarMenu","onHideAllXPanel","onShowXPanel"])};C.xbar={clCur:"xbar_lk_current",$cur:null,_init:function(){this.$items=$("#xbarList a").bind("click",function(e){if(this.className.indexOf(C.xbar.clCur)!=-1){return false}J.$win.trigger(J.EVT.ui.onClickXbarMenu,[this.getAttribute("data-xbarid")]);C.xbar.$items.removeClass(C.xbar.clCur);C.xbar.$cur=$(this).addClass(C.xbar.clCur);return false});console.log(J.ui);J.$win.bind(J.EVT.ui.onHideAllXPanel,function(e){C.xbar.reset()})},reset:function(){this.$cur&&this.$cur.removeClass(this.clCur)}};C.xpanel={curId:null,clShow:"xpanel_ani_show",clWrapShow:"xbar_bd_show",_init:function(){this.$wrap=$("#xbarBD");J.$win.bind(J.EVT.ui.onClickXbarMenu,function(e,d){C.xpanel.hide(C.xpanel.curId);C.xpanel.show(d)});$(".xbar .xbar_close").live("click",function(e){C.xpanel.hideAll(this.rel);return false})},show:function(id){var me=this,onShow=function(){$("#xpanel_"+id).addClass(me.clShow);me.curId=id;me.$wrap.onTransitioned(false);J.$win.trigger(J.EVT.ui.onShowXPanel,[id])};if(this.$wrap.hasClass(this.clWrapShow)){onShow()}else{this.$wrap.addClass(this.clWrapShow).onTransitioned(function(){onShow()})}},hide:function(id){var me=this;$("#xpanel_"+id).removeClass(this.clShow).onAnimated(function(){$(this).onAnimated(false)})},hideAll:function(panelId){var me=this;this.$wrap.removeClass(this.clWrapShow).onTransitioned(function(){me.$wrap.find(".xpanel").removeClass(me.clShow);J.$win.trigger(J.EVT.ui.onHideAllXPanel);me.$wrap.onTransitioned(false)});$('[data-xpanel_parent="'+panelId+'"]').find(".xbar_close").trigger("click")}};this._init=function(){J.$body.append(V.tpl0)}});J("uiXData",function(M,V,C){V.tpl0=J.heredoc(function(){});V.tpl1=J.heredoc(function(){});V._init=function(){J.$body.append(V.tpl1)};C._init=function(){J.uiXData.EVT(["Collapse","Open","ModChartReset","ModChartHidden","UIScroll","UIReady","DataTypeChange","DataTypeChangeForPage","ModRankRendered"])};this.maxDateRange=100;C.main={visible:false,isRendered:false,$ui:null,dataType:1,_init:function(){if(location.href.indexOf("xdata")>-1){J.$body.addClass("data_admin")}if(J.data.isBoss((J.data.bizInfo||{uid:""}).uid)){J.$body.addClass("data_boss")}setTimeout(function(){J.$win.trigger(EVT.UIReady)},100);J.$win.bind(J.EVT.uiXData.DataTypeChangeForPage,function(e,t){C.main.dataType=parseInt(t)||1;C.main.$uiCore.removeClass("data_ui_1 data_ui_2 data_ui_3").addClass("data_ui_"+t)}).bind(J.ui.EVT.onShowXPanel,function(e,panelId){if(panelId!=="data"||C.main.isRendered){return}C.main.render()})},render:function(){document.getElementById("xpanel_"+J.uiXData.id).innerHTML=V.tpl0;this.isRendered=true;this.$ui=$("#dataWrap").oxi18n();this.$uiCore=$("#dataUI");this.$hd=$("#dataUIHD");this.$bd=$("#dataUIBD");C.main.$bd.bind("scroll.modChart",function(e){J.$win.trigger(EVT.UIScroll,[C.main.$bd.scrollTop()])});this.$uiCore.bind("dblclick",function(e){C.main.$uiCore.toggleClass("data_ui_dblclick")});var bizInfo=J.data.bizInfo||{};for(var c in bizInfo){this.$ui[0].setAttribute("data-"+c,bizInfo[c])}},fixedHD:function(){this.$hd.addClass("data_fixed")},unfixedHD:function(){this.$hd.removeClass("data_fixed")},show:function(){this.$ui.removeClass("data_wrap_hide");this.visible=true;J.$win.trigger(EVT.Open)},hide:function(){this.unfixedHD();this.$ui.addClass("data_wrap_hide");this.visible=false;J.$win.trigger(EVT.Collapse)}};this.getPosition=function(){return C.main.$ui.position()};this.getOffset=function(){return C.main.$ui.offset()}});J("modchart",function(p){p.modChart={$d:null,$tip:null,$chart:null,$trigger:null,chart:null,isLoading:false,isVisible:false,hasAjaxError:false,data:{},tagData:null,dataType:1,chartOpts:null,dateRangeData:null,dataTypesTimer:null,jqXHR:null,tplMenu:J.heredoc(function(){}),_init:function(){J.$win.bind(J.ui.EVT.DataTypeChange,function(e,t){p.modChart.dataType=parseInt(t);p.modChart.refresh()}).bind(J.data.EVT.CTagUpdated,function(e,opType,d){p.modChart.onCTagUpdated(opType,d)}).bind(J.ui.EVT.Collapse,function(e){p.modChart.reset()}).bind(J.ui.EVT.UIReady,function(e){p.modChart.onCoreUIReady()})},onCoreUIReady:function(){p.modChart.$d=$("#dataPop1").oxi18n();p.modChart.$chart=$("#dataModChart");p.modChart.$tip=$("#dataModChartTip");this.$dataTypes=$("#dataTypes");$("#dataRetweet2").bind("click",function(e){if(p.modChart.isLoading){return}p.modChart.loadData(p.modChart.tagData)});$("#dataTypes .data_type").bind("click.modChart",function(e,noTriggerDataTypeEvent){if(this.value==(p.modChart.dataType+"")){return}if(!noTriggerDataTypeEvent){J.$win.trigger(J.ui.EVT.DataTypeChange,[this.value])}});$(".data_rank,.data_mods").bind("scroll.modChart",function(e){p.modChart.reset()});$("#dataPop1Close").bind("click",function(e){p.modChart.reset()});$("#dataBtnMoreFilter").hover(function(e){clearTimeout(p.modChart.dataTypesTimer);p.modChart.$dataTypes.removeClass("data_hidden")},function(e){p.modChart.dataTypesTimer=setTimeout(function(){p.modChart.$dataTypes.addClass("data_hidden")},200)});this.$dataTypes.hover(function(e){clearTimeout(p.modChart.dataTypesTimer)},function(e){p.modChart.dataTypesTimer=setTimeout(function(){p.modChart.$dataTypes.addClass("data_hidden")},200)});p.modChart.$btnTag=$("#dataTag1");var langMonth=[1+i18n.t("com.month"),2+i18n.t("com.month"),3+i18n.t("com.month"),4+i18n.t("com.month"),5+i18n.t("com.month"),6+i18n.t("com.month"),7+i18n.t("com.month"),8+i18n.t("com.month"),9+i18n.t("com.month"),10+i18n.t("com.month"),11+i18n.t("com.month"),12+i18n.t("com.month")];Highcharts.setOptions({lang:{months:langMonth,shortMonths:langMonth,weekdays:[i18n.t("com.week")+i18n.t("com.day"),i18n.t("com.week")+i18n.t("com.n1"),i18n.t("com.week")+i18n.t("com.n2"),i18n.t("com.week")+i18n.t("com.n3"),i18n.t("com.week")+i18n.t("com.n4"),i18n.t("com.week")+i18n.t("com.n5"),i18n.t("com.week")+i18n.t("com.n6")],resetZoom:i18n.t("chart.resetZoom"),resetZoomTitle:i18n.t("chart.resetZoom"),downloadPNG:i18n.t("chart.downloadPNG"),downloadJPEG:i18n.t("chart.downloadJPEG"),downloadPDF:i18n.t("chart.downloadPDF"),downloadSVG:i18n.t("chart.downloadSVG"),exportButtonTitle:i18n.t("chart.exportButtonTitle"),printChart:i18n.t("chart.printChart"),loading:i18n.t("chart.loading")}});var now=new Date(),now_7=new Date(now.getFullYear(),now.getMonth(),now.getDate()-5);this.dateRangeData={sdate0:now_7.toJSON().substr(0,10),edate0:now.toJSON().substr(0,10)};new pickerDateRange("dataLabelDateRange2",{startDate:this.dateRangeData.sdate0,endDate:this.dateRangeData.edate0,startCompareDate:"",endCompareDate:"",needCompare:true,target:"dataDateRange2",isTodayValid:true,hideOnDocClick:(location.href.indexOf("jiadian.yixun")>0?false:true),periodObj:{drpRecentDays1:6,drpRecentDays2:14,drpRecentDays3:29},clPeriodActive:"data_datepreset_item1",success:function(obj){p.modChart.dateRangeData=obj.getValue();p.modChart.loadData(p.modChart.tagData)}})},onCTagUpdated:function(opType,d){if(this.isVisible){this.reset()}},reset:function(){if(this.isLoading&&this.jqXHR&&this.jqXHR.readyState!=4){this.jqXHR.abort()}this.isLoading=false;this.hide();this.tagData=null;this.$trigger=null;J.$win.trigger(J.ui.EVT.ModChartReset)},setDataType:function(t){if(!t){return}this.dataType=t;$("#dataTypeForMod"+t).trigger("click.modChart",[true])},setCapturingData:function(){var me=this,tagInfo=J.ytag.get(this.tagData.id),dimInfo=tagInfo.$dom.data("datadim"),ytagData=[],len=tagInfo.ytags.length,ytagDimData=null,i=0,attrs=null,onDataReady=function(){attrs={"data-x":dimInfo.left,"data-y":dimInfo.top,"data-width":dimInfo.width,"data-height":dimInfo.height,"data-version_name":tagInfo.alias,"data-mod_name":tagInfo.selector,"data-version_mod_wsid":J.data.bizInfo.wsid,"data-version_mod_areaid":J.data.bizInfo.areaid,"data-version_mod_pageid":J.data.bizInfo.pid,"data-version_mod_id":tagInfo.id,"data-version_mod_ytag":JSON.stringify(ytagData)};me.$btnTag.attr(attrs)[0].removeAttribute("disabled");var lkHis=document.getElementById("dataLkTagList");lkHis.href=lkHis.getAttribute("data-href")+"?"+$.param({wsid:J.data.bizInfo.wsid,areaid:J.data.bizInfo.areaid,pageid:J.data.bizInfo.pid,modid:tagInfo.id})},rockYTagData=function(){ytagDimData=J.data.getItemDimension($('[ytag="$"]'.replace("$",tagInfo.ytags[i].page_tag)));ytagDimData=$.extend(ytagDimData,tagInfo.ytags[i]);ytagDimData.x=ytagDimData.left-dimInfo.left;ytagDimData.y=ytagDimData.top-dimInfo.top;ytagData.push(ytagDimData);if(len-i===1){onDataReady();return}if(i<len){i++;setTimeout(rockYTagData,0)}};this.$btnTag.attr("disabled","disabled");rockYTagData()},show:function(tagData,$trigger,dataTypeForPage){this.tagData=tagData;this.todayData=J.modrank.getTodayDataById(tagData.id);this.$trigger=$trigger;this.$d.addClass("data_pop1_on");J.$html.addClass("data_display");this.isVisible=true;this.renderMenu();this.setDataType(dataTypeForPage);this.refresh();this.setCapturingData()},refresh:function(){this.loadData(this.tagData)},hide:function(){this.$d.removeClass("data_pop1_on");this.isVisible=false;J.$html.removeClass("data_display");J.$win.trigger(J.ui.EVT.ModChartHidden)},updatePosition:function(){if(!this.isVisible){return}var bottom=0,$trigger=this.$trigger;if($trigger){bottom=J.$win.height()-($trigger.offset().top-J.ui.getOffset().top)-29-$trigger.outerHeight()/2}this.$d.css({bottom:bottom})},showTip:function(txt){if(txt===null){this.$tip.addClass("data_hidden");this.$d.removeClass("data_pop1_loading");return}txt=txt||'<img class="data_loading1" src="http://static.gtimg.com/icson/img/common/loading.gif"/>';this.$tip.html(txt).removeClass("data_hidden");this.$d.addClass("data_pop1_loading")},loadData:function(tagData){var dates=[],datesCache={},sdate=this.dateRangeData.sdate0,edate=this.dateRangeData.edate0,dateRange1=this.validateDateRange(sdate,edate);if(!dateRange1){return}dates.push(dateRange1);datesCache[dateRange1.id]=true;var dates1=p.modCompare.getDateRangeData(),len=dates1.length;for(var i=0;i<len;i++){dateRange1=this.validateDateRange(dates1[i].sdate,dates1[i].edate);if((!dateRange1)||datesCache[dateRange1.id]){continue}dates.push(dateRange1)}var me=this;this.data={};this.loadDateRangeData(tagData,dates,function(err,d){if(err){me.showTip(err);return}me.render(d)})},validateDateRange:function(sdate,edate){if(sdate==""||edate==""){this.showTip(i18n.t("tip.beginDateEndDateRequired"));return false}var tempDate=null;sdate=new Date(sdate);edate=new Date(edate);if(sdate>edate){tempDate=sdate;sdate=edate;edate=tempDate}edate.setDate(edate.getDate()+1);return({sdate:sdate,edate:edate,id:(sdate.getTime()+"-"+edate.getTime())})},loadDateRangeData:function(tagData,dateRanges,cbk){if(dateRanges.length===0){cbk(null,this.data);return}var dateRangeObj=dateRanges.splice(0,1)[0];if(this.isLoading&&this.jqXHR&&this.jqXHR.readyState!=4){this.jqXHR.abort();this.isLoading=false}var me=this,sdate=dateRangeObj.sdate,edate=dateRangeObj.edate,dateKey=dateRangeObj.id,dates=[];while(sdate<edate){dates.push(new Date(sdate.getFullYear(),sdate.getMonth(),sdate.getDate()));sdate.setDate(sdate.getDate()+1)}if(dates.length>J.ui.maxDateRange){cbk(i18n.t("tip.dateRangeOvertop").replace("$",J.ui.maxDateRange));return}this.showTip();this.isLoading=true;this.hasAjaxError=false;this.data[dateKey]=[];this.getDataByDates(tagData.ytagIds,dates,dateKey,function(err,d){me.isLoading=false;me.jqXHR=null;if(err){cbk(i18n.t("ajax.serverError")+err.toString());return}me.showTip(null);me.loadDateRangeData(tagData,dateRanges,cbk)},8)},parseData:function(d,dateKey,dataType){var len=d.length,r=[],dataByTime=null,pv=J.data.CurrentKeyData.total.pv,uv=J.data.CurrentKeyData.total.uv||0,rateByPv=0,rateByUv=0,valToday=0;for(var i=0;i<len;i++){dataByTime={t:d[i].t,x:d[i].t,y:0,date:J.data.getDateTimeStr(new Date(d[i].t),{len:10}),rateByPv:0,rateByUv:0,click_num:d[i].click_num,order_num:d[i].order_num,click_trans_rate:(parseFloat(d[i].click_trans_rate)||0)};switch(dataType){case 1:dataByTime.y=d[i].click_num;break;case 2:dataByTime.y=d[i].order_num;break;case 3:dataByTime.y=dataByTime.click_trans_rate;break}if((i==(len-1))&&this.endDateIsToday(dateKey)){switch(dataType){case 1:valToday=this.todayData.click_num||0;break;case 2:valToday=this.todayData.order_num||0;break;case 3:valToday=this.todayData.click_trans_rate||0;break}dataByTime.y=dataType==3?parseFloat(valToday):parseInt(valToday);dataByTime.click_num=this.todayData.click_num;dataByTime.order_num=this.todayData.order_num;dataByTime.click_trans_rate=parseFloat(this.todayData.click_trans_rate)||0}rateByPv=pv==0?0:dataByTime.y/pv;rateByPv=parseFloat((rateByPv*100).toFixed(4));dataByTime.rateByPv=rateByPv;rateByUv=uv==0?0:dataByTime.y/uv;rateByUv=parseFloat((rateByUv*100).toFixed(4));dataByTime.rateByUv=rateByUv;r.push(dataByTime)}return r},getChartSerie:function(rawData,dateKey,dataType){var niceData=this.parseData(rawData,dateKey,dataType),len=niceData.length,serieSubTitle=rawData[0].s_date+"\u81F3"+(rawData[len-1].s_date||J.data.getDateTimeStr(new Date(),{len:10})),niceData1=[],totalVal=0,totalValClickNum=0,totalValOrderNum=0,totalValCORate=0,avgVal=0,avgValClickNum=0,avgValOrderNum=0,avgValCORate=0,len=niceData.length;for(var i=0;i<len;i++){totalVal+=niceData[i].y;niceData[i].dateRange=serieSubTitle;totalValClickNum+=niceData[i].click_num;totalValOrderNum+=niceData[i].order_num;totalValCORate+=niceData[i].click_trans_rate}avgVal=parseFloat(len==0?0:(totalVal/len).toFixed(2));avgValClickNum=parseFloat(len==0?0:(totalValClickNum/len).toFixed(2));avgValOrderNum=parseFloat(len==0?0:(totalValOrderNum/len).toFixed(2));avgValCORate=parseFloat(len==0?0:(totalValCORate/len).toFixed(2));for(var i=0;i<len;i++){niceData1.push({x:niceData[i].x,y:avgVal,dateRange:serieSubTitle})}var niceData2=[];for(var i=0;i<len;i++){niceData2.push({x:niceData[i].x,y:niceData[i].rateByPv,dateRange:serieSubTitle})}var series=[{name:i18n.t("nav.a"),dateRange:serieSubTitle,data:niceData,yAxis:0,zIndex:1,marker:{lineWidth:2}},{name:i18n.t("com.avg")+i18n.t("nav.a"),dateRange:serieSubTitle,data:niceData1,yAxis:0,type:"spline",marker:{enabled:false},dashStyle:"shortdot",zIndex:1}];var showPVChart=false;if(showPVChart){series.push({name:"PV"+i18n.t("chart2.clickRate"),dateRange:serieSubTitle,data:niceData2,yAxis:1,type:"spline",zIndex:1,tooltip:{valueSuffix:" %"}})}switch(dataType){case 1:break;case 2:series[0].name=i18n.t("nav.b");series[1].name=i18n.t("com.avg")+i18n.t("nav.b");showPVChart&&(series[2].name="PV"+i18n.t("chart2.orderRate"));break;case 3:series[0].name=i18n.t("nav.c");series[1].name=i18n.t("com.avg")+i18n.t("nav.c");showPVChart&&(series[2].name="PV"+i18n.t("nav.c"));break}return({serieData:series,avgData:{avgClick:avgValClickNum,avgOrder:avgValOrderNum,avgCORate:avgValCORate}})},getChartOption:function(rawData,dataType){dataType=parseInt(dataType);var series=[],avgData=[],colors=["#1bd0dc","#f9b700","#eb6100","#009944","#eb6877","#5674b9","#a98fc2","#9999ff","#1c95bd","#9dd30d"],cnt=1,len;for(var c in rawData){c=this.getChartSerie(rawData[c],c,dataType);c.serieData[0].color=colors[cnt-1];c.serieData[1].color=J.colorLighten(colors[cnt-1],0.1);if(cnt>1){len=c.serieData[0].data.length;for(var i=0;i<len;i++){c.serieData[0].data[i].x=series[0].data[i].x;c.serieData[1]&&(c.serieData[1].data[i].x=series[0].data[i].x)}}series=series.concat(c.serieData);avgData.push(c.avgData);cnt++}var baseOpts={avgData:avgData[0],colors:colors,credits:{enabled:false,href:"http://oxox.io",text:"oxox.io",position:{align:"right",x:-10,verticalAlign:"bottom",y:0}},chart:{marginBottom:60,type:"area",zoomType:"xy",selectionMarkerFill:"rgba(122, 201, 67, 0.25)",resetZoomButton:{theme:{fill:"white",stroke:"silver",r:0,states:{hover:{fill:"#41739D",style:{color:"white"}}}}}},title:{text:" "},xAxis:{startOnTick:false,lineColor:"#6a7791",lineWidth:1,tickmarkPlacement:"on",type:"datetime",minTickInterval:24*3600*1000,dateTimeLabelFormats:{day:"%b%e"+i18n.t("com.day1")},labels:{overflow:"justify"}},yAxis:[{title:{text:null},min:0,gridLineColor:"#eae9e9",showFirstLabel:false},{title:{text:null},min:0,gridLineColor:"#eae9e9",showFirstLabel:false,labels:{formatter:function(){return this.value+" %"}},opposite:true}],tooltip:{xDateFormat:"%Y-%m-%d",useHTML:true,crosshairs:{color:"#7ac943",dashStyle:"shortdot"},borderRadius:0,shared:true,headerFormat:'<table style="text-align:right;width:190px;">',footerFormat:"</table>",pointFormat:'<tr><th rowspan="2" style="padding:3px 5px;">{point.date}</span></th></tr><tr style="border-bottom:1px solid #e8e8e8;"><td style="padding:1px 5px;width:90px;"><span style="color:{series.color}">{series.name}</td><td style="padding:1px 5px;width:90px;text-align:left">{point.y}</td></tr>'},plotOptions:{pie:{allowPointSelect:true,innerSize:"45%",cursor:"pointer",dataLabels:{enabled:false,color:"#000000",connectorColor:"#000000"}},series:{fillOpacity:0.1,shadow:false,marker:{enabled:true,fillColor:null,lineColor:"#FCFCFC",radius:6,lineWidth:1,symbol:"diamond",states:{hover:{enabled:true}}}}},legend:{enabled:true,borderWidth:0,align:"center",verticalAlign:"bottom",labelFormatter:function(){var name=this.name;if(this.name.indexOf(i18n.t("com.avg"))===0){name=i18n.t("com.avgValue")}else{}return name}},series:series};return baseOpts},render:function(data){var chartOpts=this.getChartOption(data,this.dataType),seriesLen=chartOpts.series.length;this.chartOpts=chartOpts;this.$btnTag.attr("data-version_mod_avg_click",chartOpts.avgData.avgClick).attr("data-version_mod_avg_order",chartOpts.avgData.avgOrder).attr("data-version_mod_avg_corate",chartOpts.avgData.avgCORate);if(!this.chart){p.detail.render(chartOpts.series);this.$chart.highcharts(chartOpts);this.chart=this.$chart.highcharts();this.unselectAvgSeries();return}p.detail.render(chartOpts.series);var seriesLen0=this.chart.series.length,seriesToBeRemoved=[];if(seriesLen0>seriesLen){for(var i=(seriesLen0-seriesLen);i<seriesLen0;i++){seriesToBeRemoved.push(this.chart.series[i])}}while(seriesToBeRemoved.length>0){seriesToBeRemoved.splice(0,1)[0].remove(true)}seriesLen0=seriesLen0-1;for(var i=0;i<seriesLen;i++){if(i<=seriesLen0){this.chart.series[i].update(chartOpts.series[i])}else{this.chart.addSeries(chartOpts.series[i])}}this.unselectAvgSeries();J.$win.trigger("resize.modChart")},unselectAvgSeries:function(){var len=this.chart.series.length,serie;for(var i=0;i<len;i++){serie=this.chart.series[i];if(serie.name.indexOf(i18n.t("com.avg"))===0){serie.hide()}}},renderMenu:function(){if(this.tagData.norender){return false}this.tagData.treePath[this.tagData.treePath.length-1].clActive="active";var $dataCrumbs=$("#dataCrumbs").empty().html(J.toHtml(this.tplMenu,{items:this.tagData.treePath}));var $crumbs=$dataCrumbs.find("a").bind("click.data",function(e){if(this.className.indexOf("active")!==-1){return false}$crumbs.removeClass("active");this.className="active";$("#dataLnkCTag"+this.getAttribute("data-id")).trigger("click",[{norender:true}]);return false});this.tagData.treePath[this.tagData.treePath.length-1].clActive="";return true},getDataByDates:function(tagids,dates,dateKey,cbk,maxDateCountPerTime){maxDateCountPerTime=maxDateCountPerTime||5;if(dates.length==0){cbk(null,this.data[dateKey]);return}var dates1=dates.splice(0,maxDateCountPerTime),sdate=J.data.getDateTimeStr(dates1[0]),edate=J.data.getDateTimeStr(dates1[dates1.length-1]),_params={date_type:"custom",start_date:sdate,end_date:edate,page_tag_ids:tagids.join(",")},me=this,tempItem,tempDate;this.jqXHR=J.data.getRangeClickData(_params,function(err,d){err=err||((d&&d.status)?null:"DragClickData:"+i18n.t("ajax.serverError")+(d?d.errmsg:""));if(err){me.hasAjaxError=true;cbk(err);return}for(var c in d.data.data){tempItem=d.data.data[c];tempDate=new Date(c);tempDate=new Date(tempDate.getFullYear(),tempDate.getMonth(),tempDate.getDate());tempItem.t=tempDate.getTime();me.data[dateKey].push(tempItem)}me.getDataByDates(tagids,dates,dateKey,cbk,maxDateCountPerTime)})},endDateIsToday:function(dateKey){var today=new Date(J.data.getDateTimeStr(new Date(),{len:10})),todayStr;today.setDate(today.getDate()+1);todayStr=today.getTime()+"";var is=dateKey.indexOf(todayStr)!==-1;return is}};p.modCompare={getDateRangeData:function(){var d=[];if(p.modChart.dateRangeData.sdate1&&p.modChart.dateRangeData.sdate1.length>0){d.push({sdate:p.modChart.dateRangeData.sdate1,edate:p.modChart.dateRangeData.edate1})}return d}};p.detail={dataType:1,lblDataPerPV:null,lblDataPerUV:null,tplTable:J.heredoc(function(){}),_init:function(){J.$win.bind(J.ui.EVT.DataTypeChange,function(e,t){p.detail.dataType=parseInt(t);p.detail.onDataTypeChange(p.detail.dataType)}).bind(J.ui.EVT.UIReady,function(e){p.detail.onCoreUIReady()})},onDataTypeChange:function(t){var txtTH=i18n.t("chart2.clickNumByPV"),txtTH1=i18n.t("chart2.clickNumByUV");switch(t){case 1:break;case 2:txtTH=i18n.t("chart2.orderNumByPV");txtTH1=i18n.t("chart2.orderNumByUV");break;case 3:txtTH=i18n.t("chart2.transRateByPV");txtTH1=i18n.t("chart2.transRateByUV");break}this.lblDataPerPV=txtTH;this.lblDataPerUV=txtTH1},onCoreUIReady:function(){this.$body=$("#dataDetailBody");this.lblDataPerPV=i18n.t("chart2.clickNumByPV");this.lblDataPerUV=i18n.t("chart2.clickNumByUV")},render:function(series){this.$body.empty();var data=this.parseData(series),html=J.toHtml(this.tplTable,data);this.$body.html(html).oxi18n({},true);$("#dataSorter").tablesorter()},parseData:function(series){var data={lblDataPerPV:this.lblDataPerPV,lblDataPerUV:this.lblDataPerUV,rowspanSum:2,items:[]},hasCompare=series.length>2,len=series[0].data.length,tempItem,tempItem1,total1={dateRange:series[0].dateRange,click:0,order:0,transRate:0,valueByPV:0,valueByUV:0},total2={click:0,order:0,transRate:0,valueByPV:0,valueByUV:0};for(var i=0;i<len;i++){tempItem=series[0].data[i];tempItem.rowspan=1;tempItem.childRow=false;tempItem.sn=i+1;if(hasCompare){tempItem.rowspan=2;tempItem1=series[2].data[i];tempItem1.childRow=true}else{tempItem1=null}data.items.push(tempItem);total1.click+=tempItem.click_num;total1.order+=tempItem.order_num;total1.transRate+=tempItem.click_trans_rate;total1.valueByPV+=tempItem.rateByPv;total1.valueByUV+=tempItem.rateByUv;if(tempItem1){data.items.push(tempItem1);total2.click+=tempItem1.click_num;total2.order+=tempItem1.order_num;total2.transRate+=tempItem1.click_trans_rate;total2.valueByPV+=tempItem1.rateByPv;total2.valueByUV+=tempItem1.rateByUv}}total1.transRate=len==0?0:parseFloat((total1.transRate/len).toFixed(2));total1.valueByPV=len==0?0:parseFloat((total1.valueByPV/len).toFixed(2));total1.valueByUV=len==0?0:parseFloat((total1.valueByUV/len).toFixed(2));if(hasCompare){total2.transRate=len==0?0:parseFloat((total2.transRate/len).toFixed(2));total2.valueByPV=len==0?0:parseFloat((total2.valueByPV/len).toFixed(2));total2.valueByUV=len==0?0:parseFloat((total2.valueByUV/len).toFixed(2))}data.total=[total1];if(hasCompare){total2.dateRange=series[2].dateRange;data.total.push(total2);data.rowspanSum=3}return data}};this.show=function(tagData,$trigger,dataType){p.modChart.show(tagData,$trigger,dataType)};this.isVisible=function(){return p.modChart.isVisible};this.getChartOption=function(){return p.modChart.chartOpts}});J("pagechart",function(p){p.keyChart={dataType:1,dateType:"today",dateRange:"",isLoading:false,hasAjaxError:false,$tip:null,keyData:null,clickData:null,dateRangeData:{sdate0:null,edate0:null},_init:function(){J.$win.bind(J.ui.EVT.DataTypeChangeForPage,function(e,t){p.keyChart.dataType=parseInt(t);p.keyChart.render(p.keyChart.dataType,true)}).bind(J.ui.EVT.Open,function(e,t){p.keyChart.$retweet.trigger("click.data")}).bind(J.ui.EVT.UIReady,function(e){p.keyChart.onCoreUIReady()})},onCoreUIReady:function(){this.$tip=$("#dataCharttip1");this.$tipBD=this.$tip.find(".data_charttip1_bd");this.$retweet=$("#dataRetweet1").bind("click.data",function(e){p.keyChart.loadData()});this.$filters=$("#dataChart1Filter label").bind("click.data",function(e){p.keyChart.$filters.removeClass("on");$(this).addClass("on");J.$win.trigger(J.ui.EVT.DataTypeChangeForPage,[this.getAttribute("data-type")]);return false});var today=new Date(),todayStr=J.data.getDateTimeStr(today,{len:10});this.dateRangeData.sdate0=todayStr;this.dateRangeData.edate0=todayStr;new pickerDateRange("txtDateRange1",{startDate:todayStr,endDate:todayStr,target:"dataDatePicker1",hideOnDocClick:(location.href.indexOf("jiadian.yixun")>0?false:true),isTodayValid:true,success:function(obj){p.keyChart.dateRangeData=obj.getValue();p.keyChart.$retweet.trigger("click")}})},render:function(dataType){var total=this.keyData.status?this.keyData.total:{};document.getElementById("dataPV").innerHTML=total.pv||0;document.getElementById("dataUV").innerHTML=total.uv||i18n.t("tip.uvTip");document.getElementById("dataClickNum").innerHTML=total.click_num||0;document.getElementById("dataOrderNum").innerHTML=total.order_num||0;document.getElementById("dataTransRate").innerHTML=total.click_trans_rate||0},showTip:function(txt){if(txt===null){this.$tip.addClass("data_hidden");return}var isLoading=typeof(txt)==="undefined";txt=txt||'<img class="data_loading1" src="http://static.gtimg.com/icson/img/common/loading.gif"/>';txt=isLoading?txt:(txt.indexOf("<span")==0?txt:('<span class="data_error data_errorB">'+txt+"</span>"));this.$tipBD.html(txt);this.$tip.removeClass("data_hidden")},loadData:function(){if(this.isLoading){J.data.abortKeyAndClickDataRequest();this.isLoading=false}var me=this,dates=[],tempDate=null,sdate=this.dateRangeData.sdate0,edate=this.dateRangeData.edate0;this.dateRange=sdate+"-"+edate;if(sdate==""||edate==""){me.showTip(i18n.t("tip.beginDateEndDateRequired"));return}sdate=new Date(sdate);edate=new Date(edate);if(sdate>edate){tempDate=sdate;sdate=edate;edate=tempDate}edate.setDate(edate.getDate()+1);while(sdate<edate){dates.push(new Date(sdate.getFullYear(),sdate.getMonth(),sdate.getDate()));sdate.setDate(sdate.getDate()+1)}if(dates.length>J.ui.maxDateRange){me.showTip(i18n.t("tip.dateRangeOvertop").replace("$",J.ui.maxDateRange));return}this.showTip();this.isLoading=true;this.hasAjaxError=false;this.clickData=null;this.keyData=null;this.getDataByDates(dates,function(err,d1,d2){me.isLoading=false;if(err){err=err.toString();if(err.indexOf("permission deny")>-1){err=i18n.t("tip.permissionDeny")}me.hasAjaxError=true;me.showTip(i18n.t("ajax.serverError")+err);return}me.keyData=d1;me.clickData=d2;me.showTip(null);me.render(me.dataType)})},getDataByDates:function(dates,cbk){var dLen=dates.length,sdate=J.data.getDateTimeStr(dates[0]),edate=J.data.getDateTimeStr(dates[dLen-1]),dateType=(dLen===1&&sdate==J.data.getDateTimeStr(new Date(),{ignoreHMS:true}))?"today":"custom",_params={date_type:dateType,start_date:sdate,end_date:edate},me=this;this.dateType=dateType;J.data.getKeyAndClickData(_params,cbk)}};this.isToday=function(){return(p.keyChart.dateType==="today")}});J("modeditor",function(p){p.modEditor={$d:null,$name:null,$value:null,$trigger:null,tagData:null,isVisible:false,isCustomYTag:false,tipTimer:null,_init:function(){p.modEditor.$d=$("#dataPop2");p.modEditor.$name=$("#dataPop2Ipt1");p.modEditor.$value=$("#dataPop2Ipt2");p.modEditor.$tip=$("#dataPop2Tip");$("#dataPop2Btn1").bind("click",function(e){var isOk=p.modEditor.save(this.rel);if(isOk){p.modEditor.hide()}});$("#dataPop2Btn2").bind("click",function(e){p.modEditor.del(this.rel);p.modEditor.hide()});$("#dataAddCTag").bind("click",function(e){p.modEditor.show({id:"",alias:"",ytagSelector:""},$(this),true)});$("#dataPop2Close").bind("click",function(e){p.modEditor.hide()});J.$win.bind(J.ui.EVT.Collapse,function(e){p.modEditor.hide()}).bind("resize.modEditor",function(e){p.modEditor.updatePosition()}).bind(J.ui.EVT.UIScroll,function(e,stop){p.modEditor.updatePosition(stop)});$(".data_btn_edit").live("click",function(e){var $trigger=$("#dataCTag"+this.rel),isCustomYTag=$trigger.find(".data_list_lk")[0].getAttribute("data-ytagattr")=="ctag";p.modEditor.show(J.data.getCTag(this.rel),$trigger,isCustomYTag);return false})},showTip:function(txt,duration){clearTimeout(this.tipTimer);if(!txt){this.$tip.addClass("data_hidden");return}this.$tip.removeClass("data_hidden");this.$tip.html('<span class="data_error">'+txt+"</span>");if(duration){this.tipTimer=setTimeout(function(){p.modEditor.showTip(null)},duration)}},del:function(id){J.data.deleteCTag(id)},save:function(id){var d={id:id,alias:$.trim(this.$name.val()),ytagSelector:$.trim(this.$value.val()),isCustomYTag:this.isCustomYTag,type:1};if(d.alias.length==0||d.ytagSelector.length==0){this.showTip(i18n.t("tip.modNameValueRequired"),3000);return false}var $tempDom=null;if(d.ytagSelector.indexOf(".")!=-1||d.ytagSelector.indexOf("#")!=-1){$tempDom=$(d.ytagSelector);if($tempDom.length===0){this.showTip(i18n.t("tip.modNameValueRule"),3000);return false}J.data.saveCTag(d);return true}if(d.ytagSelector.indexOf("|")==-1&&(!/^[0-9]+$/.test(d.ytagSelector))){this.showTip(i18n.t("tip.modNameValueRule"),3000);return false}var tags=d.ytagSelector.split("|"),isValid=true,len=tags.length;for(var i=0;i<len;i++){if(!(/^[0-9]+$/.test(tags[i]))){isValid=false;break}}if(!isValid){this.showTip(i18n.t("tip.modNameValueRule"),3000);return false}d.type=2;J.data.saveCTag(d);return true},show:function(tagData,$trigger,isCustomYTag){var clEditOn="data_list_item_editing";if(this.$trigger){this.$trigger.removeClass(clEditOn)}this.isCustomYTag=isCustomYTag||false;this.tagData=tagData;this.$trigger=$trigger.addClass(clEditOn);this.$d.removeClass("data_hidden");this.isVisible=true;this.updatePosition();this.loadData(tagData)},hide:function(){if(!this.isVisible){return}this.$d.addClass("data_hidden");this.$name[0].value="";this.$value[0].value="";this.isVisible=false;var clEditOn="data_list_item_editing";if(this.$trigger){this.$trigger.removeClass(clEditOn)}this.$trigger=null},updatePosition:function(){if(!this.isVisible){return}var bottom=0,$trigger=this.$trigger;bottom=this.getOffsetBottom($trigger);if($trigger){bottom=bottom-29-$trigger.outerHeight()/2}this.$d.css({bottom:bottom})},getOffsetBottom:function($dom){if(!$dom){return 0}var bottom=J.$win.height()-($dom.offset().top-J.$win.scrollTop());return bottom},loadData:function(tagData){this.$name[0].value=tagData.alias;this.$value[0].value=tagData.ytagSelector;document.getElementById("dataPop2Btn1").rel=document.getElementById("dataPop2Btn2").rel=tagData.id;if(tagData.readonly){this.$d.addClass("data_readonly")}else{this.$d.removeClass("data_readonly")}}}});J("ytag",function(p){var $ytags;p.main={coverTpl:J.heredoc(function(){}),covers:{},$ytagTrigger:null,activeNodeCssSelector:null,timeoutHoverIn:null,dataType:1,hideCovers:function(){for(var c in this.covers){this.covers[c].addClass("data_hidden")}},parseData:function(tagObj){var ctag=tagObj.ytagSelector,isCustomTagWithCssSelector=(ctag.indexOf("#")!=-1||ctag.indexOf(".")!=-1),cssSelectors=[],cssSelectors1=[],len=0;tagObj.selector="";if(isCustomTagWithCssSelector){cssSelectors=ctag.split(",");len=cssSelectors.length;tagObj.selector=ctag}else{cssSelectors=ctag.split("|");len=cssSelectors.length;for(var i=0;i<len;i++){cssSelectors1.push('[ytag="'+cssSelectors[i]+'"]')}tagObj.selector=cssSelectors1.join(",")}tagObj.$dom=$(tagObj.selector);tagObj.top=(tagObj.$dom.offset()||{top:0}).top;tagObj.$dom.each(function(i,o){o=$(o);o.data("datadim",J.data.getItemDimension(o))});return tagObj},_init:function(){J.$win.bind(J.ui.EVT.ModChartReset,function(e){p.main.reset()}).bind(J.ui.EVT.ModRankRendered,function(e){if(p.main.activeNodeCssSelector){$(p.main.activeNodeCssSelector).trigger("click.ytag")}}).bind(J.ui.EVT.ModChartHidden,function(e){p.main.activeNodeCssSelector=null}).bind(J.ui.EVT.DataTypeChangeForPage,function(e,t){p.main.dataType=parseInt(t)});$("[data-ytag]").live("click.ytag",function(e,d){p.main.onClickYTagTrigger(this,d)}).live("mouseenter.ytag",function(e,d){clearTimeout(p.main.timeoutHoverIn);var _this=this;p.main.timeoutHoverIn=setTimeout(function(){p.main.onHoverIn(_this,d)},130);return false})},reset:function(t){var clOn="data_list_lk_on";if(this.$ytagTrigger){this.$ytagTrigger.removeClass(clOn)}this.$ytagTrigger=null;this.hideCovers()},onHoverIn:function(elmTrigger,d){if(J.modrank.antiCover()){return false}var ytagData=J.ytag.get(elmTrigger.getAttribute("data-id"));J.$body.stop().animate({scrollTop:ytagData.top},"fast",function(){p.main.showCover(ytagData)});return false},onClickYTagTrigger:function(elmTrigger,d){var clOn="data_list_lk_on";if(this.$ytagTrigger){this.$ytagTrigger.removeClass(clOn)}this.$ytagTrigger=$(elmTrigger);this.$ytagTrigger.addClass(clOn);this.activeNodeCssSelector="#"+elmTrigger.id;var ytagData=J.ytag.get(elmTrigger.getAttribute("data-id"));ytagData.treePath=J.ytag.getTreePath();$.extend(ytagData,d||{});J.modchart.show(ytagData,p.main.$ytagTrigger,this.dataType)},_showCover:function(id,dim,hideOthers){if(hideOthers){this.hideCovers()}var coverId="#dataCover"+id,$cover=$(coverId),cssProps={position:"fixed",top:0,left:300,right:0,width:"auto",height:"auto",color:"red"},isHidden=dim.isHidden;var coverTip=dim.alias+(isHidden?","+i18n.t("tip.hidden"):"");if($cover.length===1){$cover.removeClass("data_hidden");if(isHidden){$cover.css(cssProps).find(".data_tagcover_bd").html(coverTip)}this.covers[id]=$cover;return}J.$body.append(J.toHtml(this.coverTpl,{id:id,coverTip:coverTip}));cssProps=isHidden?cssProps:dim;this.covers[id]=$(coverId).css(cssProps)},showCover:function(tagData){this.hideCovers();if(tagData.$dom.length==0){return}var coverDim=null;tagData.$dom.each(function(i,o){o=$(o);coverDim=o.data("datadim");coverDim.isHidden=o.is(":hidden");coverDim.alias=tagData.alias;p.main._showCover((tagData.id+i),coverDim)})}};this.get=function(id){var data=J.modrank.getDataById(id);data=p.main.parseData(data);return data};this.reset=function(){p.main.reset()};this.hideCovers=function(){p.main.hideCovers()};this.removeFromCache=function(id){cache[id]=null};this.getTreePath=function(){var path=p.main.$ytagTrigger.data("data-treepath");if(path){return path}var path=[],$parents=p.main.$ytagTrigger.parents(".data_list_item"),len=$parents.length;$parents.each(function(i,o){path.splice(0,0,$parents.eq(i).data())});p.main.$ytagTrigger.data("data-treepath",path);return path}});J("modrank",function(p){p.modRank={$d:null,dataType:1,dataChangedAt:1,dataInited:false,todayDataCache:{},antiCover:false,tpl:J.heredoc(function(){}),_init:function(){J.$win.bind(J.ui.EVT.DataTypeChangeForPage,function(e,t){p.modRank.dataType=parseInt(t);p.modRank.reload(true)}).bind(J.data.EVT.CTagUpdated,function(e,opType,d){p.modRank.onCTagUpdated(opType,d)}).bind(J.data.EVT.ClickDataChange,function(e,d){p.modRank.dataChangedAt=p.modRank.dataType;p.modRank.reload()}).bind(J.ui.EVT.UIScroll,function(e,sTop){}).bind(J.ui.EVT.UIReady,function(e){p.modRank.$d=$("#dataList1").bind("mouseleave",function(e){p.modRank.antiCover=true;J.ytag.hideCovers()}).bind("mouseenter",function(e){p.modRank.antiCover=false})}).bind(J.data.EVT.KeyDataChange,function(e,err,d){if(err){p.modRank.$d.html("")}})},onCTagUpdated:function(opType,d){switch(opType){case -1:$("#dataCTag"+d).remove();break;case 0:this.reload();break;case 1:this.reload();break}},getData:function(cbk){J.data.getAllCTags(function(items){cbk(items)})},parseTreeData:function(ctag,ptag){ctag.pid=ptag.id;ctag=this.parseSingleItem(ctag,ptag);if((!ctag.babies)||(ctag.babies.length===0)){return ctag}var len=ctag.babies.length;for(var i=0;i<len;i++){this.parseTreeData(ctag.babies[i],ctag)}return ctag},parseSingleItem:function(tempItem,parentItem){tempItem.id=tempItem.isCustomYTag?tempItem.id:tempItem.ytagSelector;tempItem.ytags=[];tempItem.ytagIds=[];tempItem.click_num=0;tempItem.order_num=0;tempItem.click_trans_rate=0;tempItem.cl1="";tempItem.clListSub="";tempItem.hasChildren=false;if(tempItem.isCustomYTag){switch(tempItem.type){case 1:tempItem.ytags=J.data.getClickDataBySelector(tempItem.ytagSelector);break;case 2:tempItem.ytags=J.data.getClickDataByIds(tempItem.ytagSelector.split("|"));break}}if(tempItem.readonly){tempItem.cl1=" data_list_item1"}if(tempItem.babies&&tempItem.babies.length>0){tempItem.cl1+=" data_list_child";tempItem.clListSub=tempItem.id=="0"?"":" data_list_con1";tempItem.hasChildren=true}ytagLen=tempItem.ytags.length;for(var j=0;j<ytagLen;j++){tempItem.ytagIds.push(tempItem.ytags[j].page_tag);tempItem.click_num+=tempItem.ytags[j].click_num;tempItem.order_num+=tempItem.ytags[j].order_num}tempItem.click_trans_rate=tempItem.click_num==0?0:parseFloat((tempItem.order_num*100/tempItem.click_num).toFixed(2));switch(this.dataType){case 1:tempItem.val=tempItem.click_num;break;case 2:tempItem.val=tempItem.order_num;break;case 3:tempItem.val=tempItem.click_trans_rate;break}tempItem=this.parseSingleItemToday(tempItem);if(tempItem.isRoot){delete parentItem.id;$.extend(tempItem,parentItem)}tempItem.val1=this.dataType===3?tempItem.val:J.formatNum(tempItem.val+"");tempItem.percent=(parentItem.val==0?0:tempItem.val*100/parentItem.val).toFixed(2);tempItem.grade=xData.score.init(J.data.CurrentKeyData.total.click_trans_rate,tempItem.click_trans_rate,1).toFixed(1);return tempItem},parseSingleItemToday:function(tempItem){if(J.pagechart.isToday()){this.todayDataCache[tempItem.id]={click_num:tempItem.click_num,order_num:tempItem.order_num,click_trans_rate:tempItem.click_trans_rate}}var todayItem=this.todayDataCache[tempItem.id];switch(this.dataType){case 1:tempItem.val0=todayItem.click_num;break;case 2:tempItem.val0=todayItem.order_num;break;case 3:tempItem.val0=todayItem.click_trans_rate;break}return tempItem},parseData:function(items){items=items||[];var len=items.length,tempItem=null,cItems=[],ytagLen=0,parentItem=J.data.getSafeCurrentKeyData(this.dataType);for(var i=0;i<len;i++){tempItem=items[i];tempItem=this.parseSingleItem(tempItem,parentItem);if(tempItem.isCustomYTag){cItems.push(tempItem)}}return cItems},sort:function(items,asc){asc=asc||false;items.sort(function(a,b){return(asc?(a.val-b.val):(b.val-a.val))});var len=items.length;for(var i=0;i<len;i++){if(items[i].babies&&items[i].babies.length>0){this.sort(items[i].babies,asc)}}},render:function(cItems,isPrepend){var emptyHtml='<div id="dataList1Tip" class="data_alert data_alertB" data-i18n="tip.noDataAdvice">无数据</div>';$("#dataList1Tip").remove();if(!isPrepend){this.$d.find(".data_list_item").remove()}if(cItems.length===0){this.$d.empty().html(emptyHtml).oxi18n({},true);return}var d0=J.data.getSafeCurrentKeyData(this.dataType),d={id:"0",babies:cItems,isCustomYTag:true,isRoot:true};this.parseTreeData(d,d0);this.sort(d.babies,false);var html=J.toHtml(this.tpl,d,{children:this.tpl});this.$d.prepend(html);if(!isPrepend){this.$d.oxi18n().oxtree({},true);J.$win.trigger(J.ui.EVT.ModRankRendered);if(J.data.privateMods.length===0){this.$d.append(emptyHtml).oxi18n({},true)}}else{$("#dataList1Tip").remove()}},reload:function(fromCache){if(fromCache){this.render(this.data);return}this.getData(function(d){p.modRank.data=d=p.modRank.parseData(d);p.modRank.render(d);if(!p.modRank.dataInited){$("#dataLoading2").remove();p.modRank.dataInited=true}})},getDataById:function(items,id){id+="";var item=null,tempItem=null,len=items.length;for(var i=0;i<len;i++){tempItem=items[i];if(id==(tempItem.id+"")){item=tempItem;break}if(tempItem.babies&&tempItem.babies.length>0){item=this.getDataById(tempItem.babies,id)}if(item){break}}return item}};this.getData=function(){return p.modRank.data};this.getDataById=function(id){return p.modRank.getDataById(p.modRank.data||[],id)};this.getTodayDataById=function(id){return p.modRank.todayDataCache[id]||{}};this.antiCover=function(){return p.modRank.antiCover}});